node {
    checkout scm

    docker.withRegistry('', 'dockerHub') {

        def customImage = docker.build("juan2203/movie-api:${env.BUILD_ID}")

        customImage.inside {
            sh 'docker run -p 3000:3000 -e MYSQL_HOST=${env.MYSQL_HOST} \
            -e MYSQL_USER=${env.MYSQL_USER} \
            -e MYSQL_PASS=${MYSQL_PASS} \
            -e MYSQL_DB=${MYSQL_DB} juan2203/movie-api:${env.BUILD_ID}'
        }

        /* Push the container to the custom Registry */
        
        customImage.push()
    }
}